name: Relay Isaac Sim 5.1 image (hardcoded creds)

on:
  workflow_dispatch:

jobs:
  relay:
    runs-on: ubuntu-latest
    env:

      # ---- 目标仓库（你的 CR）鉴权（按你的实际 CR 修改）----
      # 例子：阿里云 ACR: registry.cn-hangzhou.aliyuncs.com
      #      Docker Hub: index.docker.io
      #      GHCR: ghcr.io
      DEST_REGISTRY: "tests-ap-southeast-1.cr.volces.com"
      DEST_USERNAME: "litingjie.666@54005373"
      

      # ---- 目标镜像命名（按需改命名空间/仓库名/标签）----
      DEST_IMAGE: "tests-ap-southeast-1.cr.volces.com/haha/sim-jupyter:5.1.0"

      # ---- 源镜像（固定，不要改）----
      SRC_IMAGE: "rucio/jupyterlab:latest"

    steps:
      - name: Show Docker version
        run: |
          docker version
          docker info
      - name: login to volc cr
        run: |
          docker login tests-ap-southeast-1.cr.volces.com -u litingjie.666@54005373 -p eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImtpZCI6IkFGR0c6UTRZUDpUWTVNOkdaQ1U6SlZLVjpFWEpEOjNUWUY6Sk9LSDpPVFBJOjdOQVA6MlFaQTpQRUlFIn0.eyJpc3MiOiJjci1pc3N1ZXIiLCJzdWIiOiJsaXRpbmdqaWUuNjY2QDU0MDA1MzczIiwiYXVkIjpbImNyIl0sImV4cCI6MTc2MjM5OTkwMCwibmJmIjoxNzYyMzk2MzAwLCJpYXQiOjE3NjIzOTYzMDAsImp0aSI6IkJ1Z2syRWZ1WTJtdUZiRUgiLCJpZGVudGl0eV90eXBlIjoidXNlciIsImlkZW50aXR5X2FjY291bnRfaWQiOjIxMDg0MTE0ODcsImlkZW50aXR5X3VzZXJfaWQiOjU0MDA1MzczLCJpbmxpbmVfcG9saWN5IjoiSDRzSUFBQUFBQUFDLzZxdUJRUUFBUC8vUTcrbW93SUFBQUEifQ.JK-WMD90cA5GhOi7bY2nQX03L0ojWJkeJ1JIdkXnzGtssOdrZ_AmzEtmnBlRSeAK-2FO6QWR9Nn_XH6yPK4PhiVQOMI6IiEfwUOXG9eLj4axcj0Et5pO18EOEZp5zt-t2QkKDEEalgGSCrSpTvbmW6kNYf1sErGvFXFfdDvdO7x0E9Jk3APXjpF3Xt7u4RmUgTjXS7E098NIk_zct3ks5jivqgYlg_RNZT7cBoPvbrTFi3BdTpAw5ssrcCKhh31WVjwvxq-g5Kp38gkZ0AaR7K6v1e5B1VYMLFT0ptmEh4juxAOpqZjHUoUdCcuW5EGXlpmr54HHYNlCVMJx81YZiQ       
      - name: Pull source image
        run: |
          docker pull "${SRC_IMAGE}"

      - name: Retag for destination
        run: |
          docker tag "${SRC_IMAGE}" "${DEST_IMAGE}"
          docker images | grep isaac-sim || true

      - name: Push to destination
        run: |
          docker push "${DEST_IMAGE}"

      - name: Logout
        if: always()
        run: |
          docker logout nvcr.io || true
          docker logout "${DEST_REGISTRY}" || true
